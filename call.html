<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entab Public School - Student Admission</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 40px 20px;
            color: #2c3e50;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        .school-name {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .school-tagline {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 300;
        }

        .form-container {
            padding: 40px;
        }

        .form-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 30px;
            color: #2c3e50;
            text-align: center;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            flex: 1;
            margin-bottom: 24px;
        }

        .form-group.full-width {
            flex: none;
            width: 100%;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
            font-size: 14px;
        }

        .required::after {
            content: " *";
            color: #e74c3c;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s ease;
            background: #fff;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        input:valid {
            border-color: #27ae60;
        }

        input:invalid:not(:placeholder-shown) {
            border-color: #e74c3c;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .help-text {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 4px;
        }

        .submit-container {
            margin-top: 40px;
            text-align: center;
        }

        .submit-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 200px;
        }

        .submit-btn:hover:not(:disabled) {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 30px;
        }

        .spinner {
            border: 3px solid #ecf0f1;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #7f8c8d;
            font-size: 14px;
        }

        .message {
            margin-top: 30px;
            padding: 20px;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.5;
        }

        .success {
            background: #d5f4e6;
            color: #27ae60;
            border: 1px solid #a3e9c4;
        }

        .error {
            background: #fadbd8;
            color: #e74c3c;
            border: 1px solid #f1948a;
        }

        .info-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 16px;
            margin: 16px 0;
        }

        .info-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .info-value {
            color: #34495e;
        }

        @media (max-width: 768px) {
            body {
                padding: 20px 10px;
            }

            .form-container {
                padding: 30px 20px;
            }

            .header {
                padding: 25px 20px;
            }

            .school-name {
                font-size: 24px;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        .section-divider {
            height: 1px;
            background: #ecf0f1;
            margin: 30px 0;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #ecf0f1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="school-name">ENTAB PUBLIC SCHOOL</div>
            <div class="school-tagline">Excellence in Education â€¢ Nurturing Future Leaders</div>
        </div>
        
        <div class="form-container">
            <h2 class="form-title">Student Admission Application</h2>
            
            <form id="admissionForm">
                <div class="section-title">Student Information</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="studentName" class="required">Student's Full Name</label>
                        <input type="text" id="studentName" name="studentName" required 
                               placeholder="Enter full name as per documents">
                    </div>
                    <div class="form-group">
                        <label for="studentAge" class="required">Age</label>
                        <select id="studentAge" name="studentAge" required>
                            <option value="">Select age</option>
                            <option value="3">3 years</option>
                            <option value="4">4 years</option>
                            <option value="5">5 years</option>
                            <option value="6">6 years</option>
                            <option value="7">7 years</option>
                            <option value="8">8 years</option>
                            <option value="9">9 years</option>
                            <option value="10">10 years</option>
                            <option value="11">11 years</option>
                            <option value="12">12 years</option>
                            <option value="13">13 years</option>
                            <option value="14">14 years</option>
                            <option value="15">15 years</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="grade" class="required">Class/Standard</label>
                    <select id="grade" name="grade" required>
                        <option value="">Select class</option>
                        <option value="Nursery">Nursery</option>
                        <option value="LKG">LKG (Lower Kindergarten)</option>
                        <option value="UKG">UKG (Upper Kindergarten)</option>
                        <option value="Class 1">Class 1</option>
                        <option value="Class 2">Class 2</option>
                        <option value="Class 3">Class 3</option>
                        <option value="Class 4">Class 4</option>
                        <option value="Class 5">Class 5</option>
                        <option value="Class 6">Class 6</option>
                        <option value="Class 7">Class 7</option>
                        <option value="Class 8">Class 8</option>
                        <option value="Class 9">Class 9</option>
                        <option value="Class 10">Class 10</option>
                    </select>
                </div>

                <div class="section-divider"></div>
                <div class="section-title">Parent/Guardian Information</div>

                <div class="form-group">
                    <label for="parentName" class="required">Parent/Guardian Name</label>
                    <input type="text" id="parentName" name="parentName" required 
                           placeholder="Father's/Mother's/Guardian's name">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="parentPhone" class="required">Mobile Number</label>
                        <input type="tel" id="parentPhone" name="parentPhone" required 
                               placeholder="10-digit mobile number" pattern="[6-9][0-9]{9}">
                        <div class="help-text">Enter valid Indian mobile number</div>
                    </div>
                    <div class="form-group">
                        <label for="parentEmail">Email Address</label>
                        <input type="email" id="parentEmail" name="parentEmail" 
                               placeholder="parent@example.com">
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="address">Address</label>
                    <textarea id="address" name="address" 
                              placeholder="Complete residential address with pincode"></textarea>
                </div>

                <div class="section-divider"></div>
                <div class="section-title">Additional Information</div>

                <div class="form-group">
                    <label for="previousSchool">Previous School</label>
                    <input type="text" id="previousSchool" name="previousSchool" 
                           placeholder="Name of previous school (if any)">
                </div>

                <div class="form-group full-width">
                    <label for="medicalInfo">Medical Information</label>
                    <textarea id="medicalInfo" name="medicalInfo" 
                              placeholder="Any medical conditions, allergies, or special care requirements"></textarea>
                </div>

                <div class="form-group full-width">
                    <label for="additionalNotes">Additional Notes</label>
                    <textarea id="additionalNotes" name="additionalNotes" 
                              placeholder="Any other information or special requirements"></textarea>
                </div>

                <div class="submit-container">
                    <button type="submit" class="submit-btn">Submit Application</button>
                </div>
            </form>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Processing your application and initiating call...</div>
            </div>

            <div id="message"></div>
        </div>
    </div>

    <script>
        document.getElementById('admissionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            // Format Indian mobile number
            let phoneNumber = data.parentPhone.replace(/\D/g, '');
            if (phoneNumber.length === 10) {
                phoneNumber = '+91' + phoneNumber;
            } else if (phoneNumber.length === 12 && phoneNumber.startsWith('91')) {
                phoneNumber = '+' + phoneNumber;
            }
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.querySelector('.submit-btn').disabled = true;
            document.getElementById('message').innerHTML = '';
            
            try {
                // Compose the AI agent call script, using form data and not hardcoded names
                const aiScript = `
AI Agent Call Script - Entab Public School Admission Information

Opening & Introduction
"Good morning/afternoon. This is Jasmine calling from Entab Public School. May I please speak with ${data.parentName}?"

[Wait for parent to confirm]

"Thank you for your interest in Entab Public School. I understand you are considering admission for your child, ${data.studentName}, for grade ${data.grade}. I'm here to answer any questions you may have about our school, the admission process, and to provide you with all the information you need."

Information Sharing
"Let me start by giving you a brief overview of our school, our curriculum, and the facilities we offer. Please feel free to ask any questions at any time."

Possible Parent Questions (with suggested answers for the AI agent):

Academic Requirements
- "What are the eligibility criteria for admission to grade ${data.grade}?"
- "Are there any entrance tests or assessments required for new students?"
- "What documents will I need to submit with the application?"

Admission Process
- "Can you explain the step-by-step admission process?"
- "When does the admission process start and what are the important deadlines?"
- "Are there interviews or entrance exams for parents or students?"

School Information
- "What curriculum does the school follow?"
- "What are the school timings for grade ${data.grade}?"
- "Is transportation available for students?"
- "What extracurricular activities and sports are offered?"

Financial Information
- "What is the fee structure for this academic year?"
- "Are there any additional charges apart from tuition fees?"
- "What are the payment options and schedules?"
- "Are scholarships or fee concessions available?"

Documentation
- "Which documents are required for the admission process?"
- "Is a transfer certificate from the previous school necessary?"
- "Are there specific formats for document submission?"

Next Steps
- "How can I obtain the admission brochure and application form?"
- "What is the next step after submitting the application?"
- "Can I schedule a visit or a tour of the school campus?"
- "Who can I contact for further queries or assistance?"

Contact Information Exchange
"For your reference, here are our contact details:
- School Admissions Office Phone: [School Phone Number]
- Email: [School Admissions Email]
- School Address: [School Address]
- Website: [School Website]

And for our records, your contact information is:
- Phone: ${phoneNumber}
- Email: ${data.parentEmail || '[To be provided]'}

Closing
"Thank you, ${data.parentName}, for your interest in Entab Public School. If you have any more questions, please feel free to ask. We look forward to welcoming ${data.studentName} to our school community. Have a wonderful day!"

---
Note: This script is designed for an AI agent to call the parent, answer their questions about the school and admission process, and provide helpful information. The agent should be prepared to respond to any additional queries the parent may have.

Closing
"Thank you so much for your time and detailed information. This has been very helpful. We will prepare the necessary documents and follow up according to the timeline you've mentioned.

Is there anything specific you'd like me to convey to ${data.parentName} that we haven't discussed?

We look forward to hearing from you soon. Have a great day!"

Post-Call Notes Template
Call Summary:
- Date & Time of Call:
- Spoke with:
- Grade/Class availability:
- Key requirements:
- Next steps:
- Follow-up required by:
- Documents needed:
- Important deadlines:

Backup Questions (If Needed)
- "If this grade is full, what alternatives do you suggest?"
- "Do you have a waiting list system?"
- "When does the next admission cycle typically open?"
- "Can you recommend any preparation materials for the entrance test?"

---
Note: This script should be customized based on specific information about the student (age, current grade, previous school) and the parent's preferences before making the call.
                `;

                const callData = {
                    phone_number: phoneNumber,
                    task: `Hello, this is a call from Entab Public School regarding ${data.studentName}'s admission application for ${data.grade}. We have received your application and would like to personally connect with you to discuss the admission process. Our admission counselor will provide you with detailed information about our curriculum, facilities, fee structure, and academic calendar. We would also like to understand your expectations and answer any questions you may have about ${data.studentName}'s educational journey with us. Thank you for considering Entab Public School for your child's education. We look forward to welcoming ${data.studentName} to our school community.

-----------------
AI Agent Call Script for Reference:
${aiScript}
-----------------
`,
                    voice: "Alexa",
                    language: "en",
                    max_duration: 300,
                    answered_by_enabled: true,
                    wait_for_greeting: true,
                    record: true
                };

                const response = await fetch('https://api.bland.ai/v1/calls', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'org_c64a070e85eb4807dc0677ba9f5815eff96f1bbe3380d48f7ce4e630130f5c49ed9114fa64ccd57502f569',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(callData)
                });

                const result = await response.json();

                if (response.ok) {
                    document.getElementById('message').innerHTML = `
                        <div class="message success">
                            <strong>âœ“ Application Submitted Successfully</strong>
                            
                            <div class="info-grid">
                                <span class="info-label">Student:</span>
                                <span class="info-value">${data.studentName}</span>
                                <span class="info-label">Class:</span>
                                <span class="info-value">${data.grade}</span>
                                <span class="info-label">Parent:</span>
                                <span class="info-value">${data.parentName}</span>
                                <span class="info-label">Mobile:</span>
                                <span class="info-value">${phoneNumber}</span>
                            </div>
                            
                            <p><strong>Next Steps:</strong></p>
                            <p>You will receive a call from Entab Public School within the next few minutes. Our admission counselor will discuss:</p>
                            <p>â€¢ Admission procedures and requirements<br>
                            â€¢ School facilities and curriculum<br>
                            â€¢ Fee structure and payment options<br>
                            â€¢ Academic calendar and timings</p>
                            
                            <p style="margin-top: 16px;"><strong>Call ID:</strong> ${result.call_id}</p>
                            <p><strong>Application Reference:</strong> EPS${Date.now().toString().slice(-6)}</p>
                        </div>
                    `;
                    
                    this.reset();
                } else {
                    // Log the full error response for debugging
                    console.error('API Response:', result);
                    const errorMessage = result.message || result.error || `HTTP ${response.status}: ${response.statusText}`;
                    throw new Error(errorMessage);
                }
                
            } catch (error) {
                console.error('Error Details:', error);
                
                // Provide more detailed error information
                let errorDetails = '';
                if (error.message.includes('401')) {
                    errorDetails = '<br><br><strong>Issue:</strong> API authentication failed. Please verify your API key.';
                } else if (error.message.includes('400')) {
                    errorDetails = '<br><br><strong>Issue:</strong> Invalid request format. Please check the phone number format.';
                } else if (error.message.includes('429')) {
                    errorDetails = '<br><br><strong>Issue:</strong> Rate limit exceeded. Please try again later.';
                } else if (error.message.includes('403')) {
                    errorDetails = '<br><br><strong>Issue:</strong> Access forbidden. Please check your account permissions.';
                }
                
                document.getElementById('message').innerHTML = `
                    <div class="message error">
                        <strong>Application Received</strong>
                        <p>Your application has been submitted, but we encountered an issue initiating the automatic call.</p>
                        <p><strong>Error:</strong> ${error.message}</p>
                        ${errorDetails}
                        <p>Our admission office will contact you manually at <strong>${phoneNumber}</strong> within 24 hours.</p>
                        <p><strong>For immediate assistance:</strong><br>
                        Phone: +91-11-4567-8900<br>
                        Email: admissions@entabpublicschool.edu.in</p>
                    </div>
                `;
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.querySelector('.submit-btn').disabled = false;
            }
        });

        // Phone number validation and formatting
        document.getElementById('parentPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 10) value = value.slice(0, 10);
            e.target.value = value;
        });

        document.getElementById('parentPhone').addEventListener('blur', function(e) {
            const value = e.target.value.replace(/\D/g, '');
            const validPrefixes = ['6', '7', '8', '9'];
            
            if (value.length === 10 && validPrefixes.includes(value[0])) {
                e.target.style.borderColor = '#27ae60';
                e.target.setCustomValidity('');
            } else if (value.length > 0) {
                e.target.style.borderColor = '#e74c3c';
                e.target.setCustomValidity('Please enter a valid 10-digit mobile number starting with 6, 7, 8, or 9');
            }
        });

        document.getElementById('parentPhone').addEventListener('input', function(e) {
            e.target.setCustomValidity('');
            e.target.style.borderColor = '#e9ecef';
        });
    </script>
</body>
</html>